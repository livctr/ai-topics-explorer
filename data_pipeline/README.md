TODO: state flip after ingestion before topic hierarchy